{% extends "wagtailadmin/base.html" %}

{% load static %}

{% block extra_css %}
<style>
/* Modern Tailwind-like styles for Wagtail admin */
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
}

.w-content-wrapper {
  background: #f5f5f5;
  min-height: calc(100vh - 4rem);
  padding: 2rem;
}

.w-modal-content {
  background: white;
  border-radius: 0.75rem;
  box-shadow: 0 10px 20px -10px rgba(0, 0, 0, 0.15);
  width: 100%;
  max-width: 72rem;
  margin: 2rem auto;
  max-height: none;
  overflow: visible;
  display: flex;
  flex-direction: column;
}

.w-modal-header {
  background: linear-gradient(to right, #2D3A6B, #243158);
  padding: 1.5rem;
}

.w-modal-title {
  margin: 0;
  font-size: 1.5rem;
  font-weight: bold;
  color: white;
}

.w-modal-subtitle {
  margin: 0;
  color: white;
  font-size: 0.875rem;
  opacity: 0.9;
}

.w-modal-body {
  padding: 1.5rem;
  max-height: none;
  overflow: visible;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
}

.form-section-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: #374151;
  border-bottom: 2px solid #E5E7EB;
  padding-bottom: 0.5rem;
  margin-bottom: 1rem;
}

.form-group {
  margin-bottom: 1rem;
}

.form-label {
  display: block;
  font-size: 0.875rem;
  font-weight: 500;
  color: #374151;
  margin-bottom: 0.25rem;
}

.form-value {
  font-size: 0.875rem;
  color: #6B7280;
  padding: 0.5rem 0;
}

.items-table {
  width: 100%;
  border-collapse: collapse;
  margin: 1rem 0;
}

.items-table th,
.items-table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid #E5E7EB;
}

.items-table th {
  background: #F3F4F6;
  font-weight: 500;
  color: #374151;
  font-size: 0.875rem;
}

.items-table tbody tr:hover {
  background: #F9FAFB;
}

.items-table tfoot {
  background: #F9FAFB;
}

.items-table .total-row td {
  padding: 0.75rem;
  border-top: 2px solid #E5E7EB;
}

.items-table .grand-total {
  background: #EBF4FF;
  border-top: 3px solid #3B82F6;
}

.text-right {
  text-align: right;
}

.font-semibold {
  font-weight: 600;
}

.font-bold {
  font-weight: 700;
}

.text-lg {
  font-size: 1.125rem;
}

.grand-total-section {
  background: linear-gradient(to right, #10B981, #059669);
  color: white;
  padding: 1.5rem;
  border-radius: 0.5rem;
  margin-top: 1rem;
  text-align: center;
}

.grand-total-amount {
  font-size: 2rem;
  font-weight: bold;
  margin: 0.5rem 0;
}

.grand-total-label {
  font-size: 1rem;
  opacity: 0.9;
}

.btn {
  padding: 0.625rem 1.25rem;
  border-radius: 0.375rem;
  font-size: 0.875rem;
  font-weight: 500;
  border: none;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all 0.2s;
  text-decoration: none;
}

.btn-secondary {
  background: #F3F4F6;
  color: #374151;
  border: 1px solid #D1D5DB;
}

.btn-secondary:hover {
  background: #E5E7EB;
}

.btn-primary {
  background: linear-gradient(to right, #2D3A6B, #243158);
  color: white;
}

.btn-primary:hover {
  background: linear-gradient(to right, #213066, #182755);
}

.btn-success {
  background: linear-gradient(to right, #10B981, #059669);
  color: white;
}

.btn-success:hover {
  background: linear-gradient(to right, #059669, #047857);
}

.w-modal-footer {
  padding: 1rem 1.5rem;
  background: #F9FAFB;
  border-top: 1px solid #E5E7EB;
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  position: sticky;
  bottom: 0;
  z-index: 10;
}

.status-badge {
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 600;
}

.status-open {
  background: #FEE2E2;
  color: #991B1B;
}

.status-paid {
  background: #D1FAE5;
  color: #065F46;
}

.status-partially-paid {
  background: #FEF3C7;
  color: #92400E;
}

@media (max-width: 768px) {
  .form-grid {
    grid-template-columns: 1fr;
  }

  .w-modal-content {
    margin: 1rem auto;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="w-content-wrapper">
  <div class="w-modal-content">
    <!-- Modal Header -->
    <div class="w-modal-header">
      <h2 class="w-modal-title">Invoice Details</h2>
      <p class="w-modal-subtitle">Invoice #{{ invoice.reference_id }}</p>
    </div>

    <!-- Modal Body -->
    <div class="w-modal-body">
      <div class="form-grid">
        <!-- Left Column -->
        <div class="form-column">
          <h3 class="form-section-title">Invoice Information</h3>

          <div class="form-group">
            <label class="form-label">Invoice Number</label>
            <div class="form-value">{{ invoice.reference_id }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Customer</label>
            <div class="form-value">{{ invoice.customer.site_name|default:"N/A" }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">AMC Type</label>
            <div class="form-value">{{ invoice.amc_type.name|default:"N/A" }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Start Date</label>
            <div class="form-value">{{ invoice.start_date|date:"M d, Y" }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Due Date</label>
            <div class="form-value">{{ invoice.due_date|date:"M d, Y" }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Discount</label>
            <div class="form-value">{{ invoice.discount }}%</div>
          </div>

          <div class="form-group">
            <label class="form-label">Payment Term</label>
            <div class="form-value">{{ invoice.get_payment_term_display }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Status</label>
            <div class="form-value">
              <span class="status-badge status-{{ invoice.status }}">
                {{ invoice.get_status_display|upper }}
              </span>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="form-column">
          <h3 class="form-section-title">Customer Details</h3>

          {% if invoice.customer %}
          <div class="form-group">
            <label class="form-label">Customer Name</label>
            <div class="form-value">{{ invoice.customer.site_name }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Site Address</label>
            <div class="form-value">{{ invoice.customer.site_address|default:"N/A" }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Job Number</label>
            <div class="form-value">{{ invoice.customer.job_no|default:"N/A" }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Site ID</label>
            <div class="form-value">{{ invoice.customer.site_id|default:"N/A" }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Email</label>
            <div class="form-value">{{ invoice.customer.email|default:"N/A" }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Phone</label>
            <div class="form-value">{{ invoice.customer.phone|default:"N/A" }}</div>
          </div>
          {% else %}
          <div class="form-group">
            <div class="form-value">No customer information available</div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Items Section -->
      {% if invoice.items.all %}
      <div class="form-section">
        <h3 class="form-section-title">Invoice Items</h3>

        <div class="items-container">
          <table class="items-table">
            <thead>
              <tr>
                <th>Item</th>
                <th>Rate (₹)</th>
                <th>Qty</th>
                <th>Tax (%)</th>
                <th>Total (₹)</th>
              </tr>
            </thead>
            <tbody>
              {% for item in invoice.items.all %}
              <tr>
                <td>{{ item.item.name|default:"N/A" }}</td>
                <td class="text-right">₹{{ item.rate|floatformat:2 }}</td>
                <td class="text-right">{{ item.qty }}</td>
                <td class="text-right">{{ item.tax|floatformat:2 }}%</td>
                <td class="text-right">₹{{ item.total|floatformat:2 }}</td>
              </tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="4" class="text-right font-semibold">Subtotal:</td>
                <td class="text-right font-semibold">₹{{ invoice.get_subtotal|floatformat:2 }}</td>
              </tr>
              <tr class="total-row">
                <td colspan="4" class="text-right font-semibold">Discount ({{ invoice.discount }}%):</td>
                <td class="text-right font-semibold">₹{{ invoice.get_discount_amount|floatformat:2 }}</td>
              </tr>
              <tr class="total-row grand-total">
                <td colspan="4" class="text-right font-bold text-lg">Grand Total:</td>
                <td class="text-right font-bold text-lg">₹{{ invoice.total|floatformat:2 }}</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
      {% else %}
      <div class="form-section">
        <h3 class="form-section-title">Invoice Items</h3>
        <div class="form-value">No items found for this invoice.</div>
      </div>
      {% endif %}

      <!-- Grand Total Highlight Section -->
      <div class="grand-total-section">
        <div class="grand-total-label">GRAND TOTAL AMOUNT</div>
        <div class="grand-total-amount">₹{{ invoice.total|floatformat:2 }}</div>
        <div class="grand-total-label">{{ invoice.get_status_display|upper }} • {{ invoice.get_payment_term_display|upper }}</div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="w-modal-footer">
      <a href="/admin/snippets/invoice/invoice/" class="btn btn-secondary">Back to List</a>
      <a href="{% url 'edit_invoice_custom' invoice.reference_id %}" class="btn btn-primary">Edit Invoice</a>
      <a href="{% url 'download_invoice_pdf' invoice.pk %}" class="btn btn-success">Download PDF</a>
    </div>
  </div>
</div>
{% endblock %}
